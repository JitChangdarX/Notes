"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1769],{94449:function(e,t,n){n.d(t,{Cc:function(){return v},G:function(){return p},Us:function(){return y},iZ:function(){return f},j6:function(){return g},p4:function(){return h}});var r=n(5362),s=n(77930),i=n(41270),o=n(61122);let a=i.z.object({name:i.z.string(),description:i.z.string(),tool_key:i.z.string()}),c=i.z.object({server_name:i.z.string(),server_id:i.z.string(),is_authenticated:i.z.boolean().default(!1),tools:i.z.array(a)}),l=i.z.array(c),u="mcp-remote-tools-by-server",d=i.z.object({uuid:i.z.string().uuid(),name:i.z.string(),url:i.z.string().url(),created_at:i.z.string().datetime(),updated_at:i.z.string().datetime(),is_authenticated:i.z.boolean().default(!1)});i.z.object({name:i.z.string(),url:i.z.string()}),i.z.object({name:i.z.string().optional().nullable(),url:i.z.string().optional().nullable()});let m="mcp-remote-servers";function p(e,t){let n=(0,o.ij)();return(0,r.WE)("/api/organizations/".concat(e,"/mcp/remote_servers"),{queryKey:[m,e],enabled:n&&!!e,...t,select:e=>i.z.array(d).parse(e)})}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,s.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(e,"/mcp/remote_servers"),"POST",{...t,onSuccess:(r,s,i)=>{var o;n.invalidateQueries({queryKey:[m,e]}),n.invalidateQueries({queryKey:[u,e]}),null===(o=t.onSuccess)||void 0===o||o.call(t,r,s,i)}})}function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(0,s.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(e,"/mcp/remote_servers/").concat(t),"PUT",{...n,onSuccess:(r,s,o)=>{var a;i.invalidateQueries({queryKey:[m,e]}),i.invalidateQueries({queryKey:["mcp-remote-server-detail",e,t]}),i.invalidateQueries({queryKey:[u,e]}),null===(a=n.onSuccess)||void 0===a||a.call(n,r,s,o)}})}function f(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(0,s.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(e,"/mcp/remote_servers/").concat(t),"DELETE",{...n,onSuccess:(t,r,s)=>{var o;i.invalidateQueries({queryKey:[m,e]}),i.invalidateQueries({queryKey:[u,e]}),null===(o=n.onSuccess)||void 0===o||o.call(n,t,r,s)}})}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;return(0,r.WE)("/api/organizations/".concat(e,"/mcp/tools/servers"),{queryKey:[u,e],enabled:!!e&&t,...n,select:e=>l.parse(e)})}function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(0,s.useQueryClient)();return(0,r.uC)("/api/organizations/".concat(e,"/mcp/logout/").concat(t),"POST",{...n,onSuccess:(t,r,s)=>{var o;i.invalidateQueries({queryKey:[m,e]}),i.invalidateQueries({queryKey:[u,e]}),null===(o=n.onSuccess)||void 0===o||o.call(n,t,r,s)}})}},61122:function(e,t,n){n.d(t,{$Y:function(){return d},Ti:function(){return u},ij:function(){return l}});var r=n(19170),s=n(28803),i=n(3053),o=n(27218),a=n(87033),c=n(91217);let l=()=>{let{value:e}=(0,a.FL)("papi_mcp");return e},u=()=>{let{value:e}=(0,a.FL)("papi_mcp_ws");return e},d=()=>{let{conversation:e}=(0,c.r)(),{account:t}=(0,o.t)(),{track:n}=(0,i.z$)(),{mutate:a}=(0,r.Ck)(),{mutate:l}=(0,s.T$)(null==e?void 0:e.id);return{toggleMcpToolEnabled:(r,s)=>{if(!t)return;let i=Array.isArray(r)?r.reduce((e,t)=>({...e,[t]:s}),{}):{[r]:s};if(e){var o;l({settings:{enabled_mcp_tools:{...null===(o=e.conversationSettings)||void 0===o?void 0:o.enabled_mcp_tools,...i}}})}let c=t.settings.enabled_mcp_tools;a({...t.settings,enabled_mcp_tools:{...c,...i}}),n({event_key:"claudeai.conversation.setting.toggled",conversation_uuid:(null==e?void 0:e.id)||null,setting:"enabled_mcp_tools.".concat(r),value:s})}}}},80934:function(e,t,n){n.d(t,{McpProvider:function(){return O},q:function(){return A},c:function(){return N}});var r=n(27573);n(95622);var s=n(27218),i=n(7653),o=n(94449),a=n(61122),c=n(3053),l=n(27895),u=n(65654),d=n(77879),m=n(85023);function p(){return new m.K({name:"claude-ai",version:"0.1.0"},{capabilities:{}})}async function h(e){let t=p();return await t.connect(e),t}var v=n(74750);function f(e){let{mcpClients:t}=e,[n,r]=(0,i.useState)([]),s=(0,i.useRef)(!1),o=(0,i.useRef)(null),a=(0,i.useRef)(!1),{addError:d}=(0,l.e)(),{track:m}=(0,c.z$)(),p=(0,i.useCallback)(async(e,n,r)=>{if("auto-dolphin"===e){let e=a.current?"Claude would like to run the tool “".concat(n.name,"” but was previously interrupted. Do you want to allow this?"):"Claude would like to run the tool “".concat(n.name,"”. Do you want to allow this?");if(s.current&&!confirm(e))return m({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(r).length}),a.current=!0,{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],isError:!0};o.current=Date.now(),s.current=!1}try{let s=await t[e].callTool({name:n.name,arguments:r},u.M$,{timeout:24e4});if(m({event_key:"mcp.tools.called",result:"success",argument_count:Object.keys(r).length}),"content"in s)return s;return{content:[{type:"text",text:JSON.stringify(s.toolResult,null,2)}],isError:!1}}catch(e){throw d("Failed to call tool ".concat(n.name,": ").concat(e)),m({event_key:"mcp.tools.called",result:"failure",argument_count:Object.keys(r).length}),e}},[d,t,m]);return(0,i.useEffect)(()=>{let e=!1;return async function(){if(!t)return;let n=await (0,v.k)(t,{method:"tools/list",params:{}},u.Gd);e||r(Object.entries(n).map(e=>{var t;let[n,r]=e;return m({event_key:"mcp.tools.listed",tool_count_on_server:r.tools.length}),null!==(t=r.tools.map(e=>({...e,serverName:n,callback:t=>p(n,e,t)})))&&void 0!==t?t:[]}).flat())}(),()=>{e=!0}},[p,t,m]),{tools:n,onDolphinInterrupted:(0,i.useCallback)(()=>{if("number"==typeof o.current&&Date.now()<o.current+100)return},[o])}}class g{start(){return this._port.onmessage=e=>{var t;null===(t=this.onmessage)||void 0===t||t.call(this,e.data)},this._port.onmessageerror=e=>{var t;null===(t=this.onerror)||void 0===t||t.call(this,Error("MessagePort message error: ".concat(e.data)))},Promise.resolve()}close(){var e;return this._port.close(),null===(e=this.onclose)||void 0===e||e.call(this),Promise.resolve()}send(e){return this._port.postMessage(e),Promise.resolve()}constructor(e){this._port=e}}async function y(e){return h(new g(e))}var w=n(5362);u.kO.shape.params;var _=n(38622),C=n(66894),b=n(19980),k=n(48973),S=n(41270),z=n(68571);let E=()=>{let[e,t]=(0,i.useState)({});return(0,i.useEffect)(()=>{(async function(){if((0,C.yG)()&&!z.env.DONT_USE_EXAMPLE_MCP){let e=function(){let e=new k.q({name:"Demo",version:"1.0.0"});return e.tool("add",{a:S.z.number(),b:S.z.number()},e=>{let{a:t,b:n}=e;return{content:[{type:"text",text:String(t+n)}]}}),e.tool("greet_person",{name:S.z.string(),greeting:S.z.string()},e=>{let{name:t,greeting:n}=e;return{content:[{type:"text",text:"Message sent to ".concat(t,": ").concat(n," ").concat(t,"!")}]}}),e.resource("Available greetings","greeting://all_greetings",e=>({contents:[{uri:e.href,text:"Hello!"},{uri:e.href,text:"Hi!"},{uri:e.href,text:"Hey!"}]})),e.prompt("ask_to_greet",{name:S.z.string()},e=>{let{name:t}=e;return{messages:[{role:"user",content:{type:"text",text:"Please greet: ".concat(t)}}]}}),e}(),[n,r]=b.e.createLinkedPair();(async()=>{await e.connect(r)})(),await h(n).then(e=>{t({exampleServer:e})})}})()},[]),e};var M=n(87033);let T=()=>{let{track:e}=(0,c.z$)();return{trackMcpServerAuthFailure:(0,i.useCallback)(t=>{e({event_key:"mcp.websocket.authfailure",server_uuid:t})},[e]),trackMcpServerConnected:(0,i.useCallback)((t,n,r)=>{e({event_key:"mcp.websocket.transport.connected",result:null!=r?r:"success",server_uuid:t,used_authentication:n})},[e]),trackMcpServerReconnected:(0,i.useCallback)((t,n)=>{e({event_key:"mcp.websocket.transport.reconnected",result:"success",server_uuid:t,used_authentication:n})},[e])}};class x extends Error{constructor(e){super(e||"Authentication error"),this.name="UnauthedError"}}class P{start(){if(this._socket)throw Error("WebSocketClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,t)=>{this._socket=new WebSocket(this._url,["mcp"]),this._socket.onerror=e=>{var n;let r="error"in e?e.error:Error("WebSocket error: ".concat(JSON.stringify(e)));t(r),null===(n=this.onerror)||void 0===n||n.call(this,r)},this._socket.onopen=()=>{e()},this._socket.onclose=e=>{var t;null===(t=this.onclose)||void 0===t||t.call(this)},this._socket.onmessage=e=>{var t,n,r,s;let i;try{i=u.s6.parse(JSON.parse(e.data))}catch(e){null===(n=this.onerror)||void 0===n||n.call(this,e);return}let o=i;o.error&&-32001===o.error.code&&(null===(r=this.onAuthError)||void 0===r||r.call(this,new x));let a=i;"connected"===a.method&&a.params&&(null===(s=this.onConnect)||void 0===s||s.call(this,a.params.used_auth)),null===(t=this.onmessage)||void 0===t||t.call(this,i)}})}async close(){var e;null===(e=this._socket)||void 0===e||e.close()}send(e){return new Promise((t,n)=>{var r;if(!this._socket){n(Error("Not connected"));return}null===(r=this._socket)||void 0===r||r.send(JSON.stringify(e)),t()})}constructor(e){this._url=e}}class R{async refreshClient(){return this.cachedClient=await this.getClient(),this.cachedClient}async initialize(){await this.refreshClient()}async connect(e){throw await Promise.resolve(),Error("Cannot call connect on a wrapped client")}async close(){return(await this.refreshClient()).close()}async registerCapabilities(e){return(await this.refreshClient()).registerCapabilities(e)}getServerCapabilities(){var e;return null===(e=this.cachedClient)||void 0===e?void 0:e.getServerCapabilities()}getServerVersion(){var e;return null===(e=this.cachedClient)||void 0===e?void 0:e.getServerVersion()}getInstructions(){var e;return null===(e=this.cachedClient)||void 0===e?void 0:e.getInstructions()}async ping(e){return(await this.refreshClient()).ping(e)}async complete(e,t){return(await this.refreshClient()).complete(e,t)}async setLoggingLevel(e,t){return(await this.refreshClient()).setLoggingLevel(e,t)}async getPrompt(e,t){return(await this.refreshClient()).getPrompt(e,t)}async listPrompts(e,t){return(await this.refreshClient()).listPrompts(e,t)}async listResources(e,t){return(await this.refreshClient()).listResources(e,t)}async listResourceTemplates(e,t){return(await this.refreshClient()).listResourceTemplates(e,t)}async readResource(e,t){return(await this.refreshClient()).readResource(e,t)}async subscribeResource(e,t){return(await this.refreshClient()).subscribeResource(e,t)}async unsubscribeResource(e,t){return(await this.refreshClient()).unsubscribeResource(e,t)}async callTool(e,t,n){return(await this.refreshClient()).callTool(e,t,n)}async listTools(e,t){return(await this.refreshClient()).listTools(e,t)}async sendRootsListChanged(){return(await this.refreshClient()).sendRootsListChanged()}async request(e,t,n){let r=await this.getClient();return this.cachedClient=r,r.request(e,t,n)}async notification(e){let t=await this.getClient();return this.cachedClient=t,t.notification(e)}async setRequestHandler(e,t){return(await this.refreshClient()).setRequestHandler(e,t)}async removeRequestHandler(e){return(await this.refreshClient()).removeRequestHandler(e)}async assertCanSetRequestHandler(e){return(await this.refreshClient()).assertCanSetRequestHandler(e)}async setNotificationHandler(e,t){return(await this.refreshClient()).setNotificationHandler(e,t)}async removeNotificationHandler(e){return(await this.refreshClient()).removeNotificationHandler(e)}async assertCapabilityForMethod(e){return(await this.refreshClient()).assertCapabilityForMethod(e)}async assertNotificationCapability(e){return(await this.refreshClient()).assertNotificationCapability(e)}async assertRequestHandlerCapability(e){return(await this.refreshClient()).assertRequestHandlerCapability(e)}get transport(){var e;return null===(e=this.cachedClient)||void 0===e?void 0:e.transport}constructor(e,t){this.getClient=e,this.cachedClient=t}}var j=n(68571);let q=(0,i.createContext)({mcpClients:{},servers:void 0,mcpTools:[],isLoading:!1,isEnabled:!1}),N=()=>{let e=(0,i.useContext)(q);return e||console.warn("useMcp being used outside of McpProvider, this is probably a bug"),e};function O(e){let{children:t}=e,n=(0,a.ij)(),m=(0,a.Ti)(),{mcpClients:h,servers:v=[],serversWithState:g,isLoading:b}=function(){let{activeOrganization:e}=(0,s.t)(),{trackMcpServerAuthFailure:t,trackMcpServerConnected:n,trackMcpServerReconnected:r}=T(),{data:c,isLoading:l}=(0,o.G)(null==e?void 0:e.uuid),[u,d]=(0,i.useState)({}),[m,h]=(0,i.useState)(!0),v=(0,a.Ti)(),f=(0,i.useRef)({}),{value:g}=(0,M.FL)("apps_claudeai_use_mcp_ws_reconnect_client");async function y(e,t,n,r){let s=function(){if((0,C.yG)()){let e=j.env.NEXT_PUBLIC_MCP_WEBSOCKET_BACKEND||"http://localhost:8000";if(null==e?void 0:e.startsWith("http"))return e.replace("http","ws");if(null==e?void 0:e.startsWith("ws"))return e.replace("https","wss")}return""}(),i=new P("".concat(s,"/api/ws/organizations/").concat(e,"/mcp/servers/").concat(t,"/"));i.onAuthError=n,i.onConnect=r;let o=p();return await o.connect(i),o}let w=(0,i.useCallback)(async(e,t,n,r)=>{let s="".concat(e,",").concat(t);if(f.current[s]){var i;if(f.current[s]instanceof Promise){let e=await f.current[s];return f.current[s]=e,e}if((i=f.current[s])&&(null==i?void 0:i.transport)!==void 0)return f.current[s]}let o=y(e,t,n,r);return f.current[s]=o,await o},[]),[_,b]=(0,i.useState)([]);return(0,i.useEffect)(()=>{(async function(){if(!(null==e?void 0:e.uuid)||!v||!c){d({});return}b(c.map(e=>({...e,usedAuthentication:!1,connecting:!0,connected:!1}))),h(!0),await Promise.all(c.map(async s=>{let i=e=>{t(s.uuid),b(e=>e.map(e=>e.uuid===s.uuid?{...e,usedAuthentication:!1,connecting:!1,connected:!1}:e))},o=e=>{b(t=>t.map(t=>t.uuid===s.uuid?{...t,usedAuthentication:e,connecting:!1,connected:!0}:t))};try{let t=await w(e.uuid,s.uuid,i,e=>o(e)),n=async()=>await w(e.uuid,s.uuid,i,e=>(r(s.uuid,e),o(e))),a=g?t:new R(n,t);d(e=>({...e,[s.name]:a}))}catch(e){n(s.uuid,!1,"failure"),console.error("Failed to connect to remote MCP server ".concat(s.name,":"),e),b(e=>e.map(e=>e.uuid===s.uuid?{...e,connecting:!1}:e))}}))})().then(()=>{h(!1)})},[e,c,v,d,h,w,g,t,n,r]),{mcpClients:u,servers:c,isLoading:l||m,serversWithState:_}}(),{tools:k}=f({mcpClients:h}),{activeOrganization:S}=(0,s.t)(),{data:z,isLoading:x}=(0,o.j6)(null==S?void 0:S.uuid,n&&!m),{prompts:N,resources:O}=(0,_.Tz)(h),A=(0,i.useMemo)(()=>v.map(e=>{var t;let n=null==z?void 0:z.reduce((e,t)=>({...e,[t.server_name]:[...e[t.server_name]||[],...t.tools]}),{}),r=k.filter(t=>t.serverName===e.name),s=g.find(t=>t.uuid===e.uuid),i=!!s&&!0===s.connected,o=null!==(t=null==s?void 0:s.connecting)&&void 0!==t&&t;return{name:e.name,uuid:e.uuid,type:"remote",client:h[e.name],url:e.url,isConnected:i,isLoading:o,isAuthless:i&&(null==s?void 0:s.usedAuthentication)===!1,tools:m?r:(null==n?void 0:n[e.name])||[],prompts:N[e.name]||[],resources:O[e.name]||[]}}),[v,h,N,O,k,z,m,g]),{mcpClients:L,isLoading:H}=function(){let[e,t]=(0,i.useState)({}),[n,r]=(0,i.useState)(!1),{addError:s}=(0,l.e)(),{onDolphinInterrupted:o}=f({mcpClients:e}),{track:a}=(0,c.z$)(),m=(0,i.useCallback)(e=>{if(e.source!==window)return;let{type:n,serverName:r}=e.data;if("mcp-server-connected"!==n||!r)return;let[i]=e.ports;y(i).then(e=>{console.log("Connected to MCP server ".concat(r)),t(t=>({...null!=t?t:{},[r]:e})),"dolphin"===r&&e.setNotificationHandler(u.b5,e=>{"USER_INTERRUPT"===e.params.data&&o()}),a({event_key:"mcp.servers.connected",result:"success"})},e=>{console.error("Could not attach to MCP server ".concat(r,":"),e),s("Could not attach to MCP server ".concat(r)),a({event_key:"mcp.servers.connected",result:"failure"})})},[s,a,o]);(0,d.OR)("message",m);let p=function(e){let t=(0,i.useRef)(e);return(0,i.useEffect)(()=>{t.current=e},[e]),(0,i.useCallback)(function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.current(...n)},[])}(a);return(0,i.useEffect)(()=>{let e=!1;async function t(){var t,n;if(!(null===(t=window.claudeAppBindings)||void 0===t?void 0:t.listMcpServers)||!(null===(n=window.claudeAppBindings)||void 0===n?void 0:n.connectToMcpServer))return;let r=await window.claudeAppBindings.listMcpServers();p({event_key:"mcp.servers.listed",server_count:r.length}),e||await Promise.all(r.map(e=>window.claudeAppBindings.connectToMcpServer(e).catch(t=>{console.error("Could not connect to MCP server ".concat(e,":"),t),s("Could not connect to MCP server ".concat(e))})))}return r(!0),t().finally(()=>r(!1)),()=>{e=!0}},[s,p]),{mcpClients:e,isLoading:n}}(),F=E(),K=(0,i.useMemo)(()=>({...L,...F}),[L,F]),{tools:Q}=f({mcpClients:K}),{prompts:I,resources:$}=(0,_.Tz)(K),B=(0,i.useMemo)(()=>{let e=e=>e?"".concat(e.name," v").concat(e.version):void 0;return Object.entries(K).map(t=>{let[n,r]=t;return{name:n,uuid:"local:".concat(n),type:"local",client:r,usedAuthentication:!1,isAuthless:!0,tools:Q.filter(e=>e.serverName===n),prompts:I[n]||[],resources:$[n]||[],version:e(r.getServerVersion())}})},[K,Q,I,$]),D=(0,i.useMemo)(()=>({...h,...K}),[h,K]);!function(e){let{mcpClients:t}=e,{addError:n}=(0,l.e)(),{track:r}=(0,c.z$)(),{activeOrganization:o}=(0,s.t)(),a=(0,w.uC)("/api/organizations/".concat(null==o?void 0:o.uuid,"/dust/mcp_messages"),"POST",{enabled:!1,onError:()=>n("MCP sampling failed")});(0,i.useEffect)(()=>{},[!1,t,a,r])}({mcpClients:D});let U=(0,i.useMemo)(()=>[...k,...Q],[k,Q]),W=(0,i.useMemo)(()=>[...A,...B],[A,B]),G=(0,i.useMemo)(()=>Object.keys(D).length>0,[D]);return(0,r.jsx)(q.Provider,{value:{mcpClients:D,servers:n||m?W:void 0,mcpTools:U,isLoading:b||H||x,isEnabled:G},children:t})}function A(e,t){return"".concat(e,":").concat(t)}},74750:function(e,t,n){n.d(t,{k:function(){return s}});var r=n(65654);async function s(e,t,n,s){return e?Object.fromEntries((await Promise.all(Object.entries(e).map(async e=>{let[i,o]=e;try{let e=await o.request(t,n,{timeout:5e3,...s});return[i,e]}catch(e){if(e instanceof r.yp&&e.code===r.jK.MethodNotFound)return null;return console.error("Request ".concat(t.method," to ").concat(i," failed: ").concat(e)),null}}))).filter(e=>null!==e)):{}}},38622:function(e,t,n){n.d(t,{Tz:function(){return u},Vr:function(){return m},ff:function(){return d}});var r=n(5161),s=n(3053),i=n(27895),o=n(65654),a=n(7653),c=n(91217),l=n(74750);function u(e){let{track:t}=(0,s.z$)(),[n,r]=(0,a.useState)({}),[i,c]=(0,a.useState)({});return(0,a.useEffect)(()=>{let n=!1;async function s(){if(!e)return;let s=await (0,l.k)(e,{method:"resources/list",params:{}},o.Ol,{timeout:6e5}),i=await (0,l.k)(e,{method:"prompts/list",params:{}},o.ev,{timeout:6e5});if(n)return;let a={},u={};Object.entries(s).forEach(e=>{var n,r,s;let[i,o]=e;t({event_key:"mcp.resources.listed",resource_count_on_server:null!==(r=null===(n=o.resources)||void 0===n?void 0:n.length)&&void 0!==r?r:0}),a[i]=(null!==(s=o.resources)&&void 0!==s?s:[]).sort((e,t)=>e.name.localeCompare(t.name))}),Object.entries(i).forEach(e=>{var n,r,s;let[i,o]=e;t({event_key:"mcp.prompts.listed",prompt_count_on_server:null!==(r=null===(n=o.prompts)||void 0===n?void 0:n.length)&&void 0!==r?r:0}),u[i]=(null!==(s=o.prompts)&&void 0!==s?s:[]).sort((e,t)=>e.name.localeCompare(t.name))}),r(a),c(u)}s();let i=setInterval(()=>void s(),6e5);return()=>{n=!0,clearInterval(i)}},[e,t]),{resources:n,prompts:i}}function d(){let{addError:e}=(0,i.e)(),{track:t}=(0,s.z$)(),{handleUpload:n}=(0,c.r)();return(0,a.useCallback)(async(r,s)=>{try{let e=(await r.request({method:"resources/read",params:{uri:s.uri}},o.vg,{timeout:15e3})).contents.map(e=>{let n;return"text"in e?(n=String(e.text),t({event_key:"mcp.resources.read",type:"text",mime_type:e.mimeType})):(n=p(e.blob),t({event_key:"mcp.resources.read",type:"binary",mime_type:e.mimeType})),new File([n],s.name,{type:e.mimeType})});e.length>0&&await n(e)}catch(t){e("Error uploading resource: ".concat(t))}},[t,e,n])}function m(e){let{track:t}=(0,s.z$)(),{addError:n}=(0,i.e)(),{handleUpload:l}=(0,c.r)();return(0,a.useCallback)(async(s,i,a)=>{if(s&&i)try{let n=await s.request({method:"prompts/get",params:{name:i.name,arguments:a}},o.Go,{timeout:15e3});t({event_key:"mcp.prompts.used",argument_count:Object.keys(a).length,assistant_messages:n.messages.filter(e=>"assistant"===e.role).length,user_messages:n.messages.filter(e=>"user"===e.role).length,text_messages:n.messages.filter(e=>"text"===e.content.type).length,image_messages:n.messages.filter(e=>"image"===e.content.type).length});let c=(e,t)=>{let n=e=>{let t=r.wI[e];if(!t)throw Error("Unsupported MIME type: ".concat(e));return t},s=e=>"".concat(i.name).concat(t?"_".concat(t):"",".").concat(e);switch(e.content.type){case"text":return new File([e.content.text],s("txt"),{type:"text/plain"});case"image":{let t=n(e.content.mimeType);return new File([p(e.content.data)],s(t),{type:e.content.mimeType})}case"resource":if("text"in e.content.resource){var o;let t=e.content.resource;return new File([t.text],"".concat(t.uri,".txt"),{type:null!==(o=t.mimeType)&&void 0!==o?o:"text/plain"})}if("blob"in e.content.resource){let t=e.content.resource;if(!t.mimeType)throw Error("Missing MIME type for embedded resource");let r=n(t.mimeType);return new File([p(t.blob)],"".concat(t.uri,".").concat(r),{type:t.mimeType})}throw Error("Invalid resource content")}};if(1===n.messages.length)await l([c(n.messages[0],0)]);else if(n.messages.length>1){let e=n.messages.flatMap((e,t)=>"image"===e.content.type||"resource"===e.content.type&&"blob"in e.content.resource?[c(e,t)]:[]),t=n.messages.filter(e=>"text"===e.content.type||"resource"===e.content.type&&"text"in e.content.resource);if(t.length>0){let n=JSON.stringify(t,null,2);e.push(new File([n],"".concat(i.name,"_messages.json"),{type:"application/json"}))}await l(e)}null==e||e()}catch(e){n("Error getting prompt: ".concat(e))}},[t,n,l,e])}function p(e){let t=window.atob(e),n=new ArrayBuffer(t.length),r=new Uint8Array(n);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return n}},11607:function(e,t,n){n.r(t),n.d(t,{Loading:function(){return a}});var r=n(27573),s=n(10607),i=n(7653),o=n(45790);let a=(0,i.memo)(function(e){let{size:t="md",fullscreen:n=!1,inheritColor:a,delay:c=0}=e,[l,u]=(0,i.useState)(c>0);return(0,i.useEffect)(()=>{if(!c)return;let e=setTimeout(()=>u(!1),c);return()=>clearTimeout(e)},[c]),(0,r.jsx)("div",{className:(0,s.Z)(n?"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2":"m-auto"),children:(0,r.jsx)("div",{className:(0,s.Z)("sm"===t&&"h-4 w-4 border-2","md"===t&&"h-20 w-20 border-8",a?"border-current":"border-border-200","text-secondary inline-block animate-spin rounded-full border-solid border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",l&&"hidden"),role:"status",children:(0,r.jsx)("span",{className:"sr-only",children:(0,r.jsx)(o.Z,{defaultMessage:"Loading...",id:"gjBiyjshwX"})})})})})}}]);